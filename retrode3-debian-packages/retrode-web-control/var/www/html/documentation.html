<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2487.7">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 18.0px Helvetica; -webkit-text-stroke: #38ff0f}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; -webkit-text-stroke: #000000}
    p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; -webkit-text-stroke: #38ff0f}
    p.p4 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; -webkit-text-stroke: #38ff0f; min-height: 14.0px}
    p.p5 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Helvetica; -webkit-text-stroke: #000000}
    p.p6 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Helvetica; -webkit-text-stroke: #000000; min-height: 17.0px}
    p.p7 {margin: 0.0px 0.0px 0.0px 0.0px; font: 11.0px Monaco; -webkit-text-stroke: #000000}
    p.p8 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; -webkit-text-stroke: #000000; min-height: 14.0px}
    p.p9 {margin: 0.0px 0.0px 0.0px 0.0px; font: 11.0px Monaco; -webkit-text-stroke: #000000; min-height: 15.0px}
    p.p10 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; color: #0000e9; -webkit-text-stroke: #000000}
    p.p11 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Helvetica; -webkit-text-stroke: #38ff0f}
    p.p12 {margin: 0.0px 0.0px 0.0px 0.0px; font: 10.0px Monaco; -webkit-text-stroke: #000000}
    p.p13 {margin: 0.0px 0.0px 0.0px 0.0px; font: 10.0px Monaco; -webkit-text-stroke: #000000; min-height: 14.0px}
    p.p14 {margin: 0.0px 0.0px 0.0px 0.0px; font: 18.0px Helvetica; -webkit-text-stroke: #000000}
    p.p15 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; color: #0000bd; -webkit-text-stroke: #000000}
    p.p16 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; color: #000000; -webkit-text-stroke: #000000; min-height: 14.0px}
    p.p17 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; color: #000000; -webkit-text-stroke: #000000}
    p.p18 {margin: 0.0px 0.0px 0.0px 0.0px; font: 10.0px Monaco; color: #000000; -webkit-text-stroke: #000000; min-height: 14.0px}
    p.p19 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; color: #0000d3; -webkit-text-stroke: #000000}
    span.s1 {font-kerning: none}
    span.s2 {font: 12.0px Helvetica; text-decoration: underline ; font-kerning: none; color: #0000d3; -webkit-text-stroke: 0px #000000}
    span.s3 {font-kerning: none; color: #0000e3}
    span.s4 {text-decoration: underline ; font-kerning: none; color: #0000e9}
    span.s5 {font: 12.0px Helvetica; text-decoration: underline ; font-kerning: none; color: #0000e3; -webkit-text-stroke: 0px #000000}
    span.s6 {font-kerning: none; -webkit-text-stroke: 0px #38ff0f}
    span.s7 {font-kerning: none; font-variant-ligatures: common-ligatures}
    span.s8 {font: 12.0px Helvetica; font-kerning: none}
    span.s9 {font-kerning: none; color: #000000}
    span.s10 {text-decoration: underline ; font-kerning: none; color: #0000bd}
    span.s11 {text-decoration: underline ; font-kerning: none}
    span.s12 {font: 12.0px Helvetica; font-kerning: none; -webkit-text-stroke: 0px #000000}
    span.s13 {text-decoration: underline ; font-kerning: none; color: #0000d3}
    span.s14 {font: 10.0px Monaco; font-kerning: none}
    table.t1 {border-collapse: collapse}
    td.td1 {width: 310.0px; border-style: solid; border-width: 1.0px 1.0px 1.0px 1.0px; border-color: #484848 #484848 #484848 #484848; padding: 0.0px 5.0px 0.0px 5.0px}
    td.td2 {width: 317.0px; border-style: solid; border-width: 1.0px 1.0px 1.0px 1.0px; border-color: #484848 #484848 #484848 #484848; padding: 0.0px 5.0px 0.0px 5.0px}
  </style>
</head>
<body>
<p class="p1"><span class="s1"><b>1. User Documentation</b></span></p>
<p class="p2"><span class="s1">There should be sections about:</span></p>
<p class="p3"><span class="s1">- unpacking</span></p>
<p class="p3"><span class="s1">- installation</span></p>
<p class="p3"><span class="s1">- operation</span></p>
<p class="p3"><span class="s1">- limitations</span></p>
<p class="p3"><span class="s1">- warnings</span></p>
<p class="p3"><span class="s1">- certifications</span></p>
<p class="p3"><span class="s1">- troubleshooting</span></p>
<p class="p3"><span class="s1">- maintenance</span></p>
<p class="p4"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><b>2. System architecture</b></span></p>
<p class="p3"><span class="s1">There should be sections about:</span></p>
<p class="p3"><span class="s1">- how to access the device through FTDI header (if installed), USB-Console, ssh, smb</span></p>
<p class="p3"><span class="s1">- optional buttons</span></p>
<p class="p3"><span class="s1">- how to control LEDs</span></p>
<p class="p4"><span class="s1"></span><br></p>
<p class="p3"><span class="s1">Software layers:</span></p>
<table cellspacing="0" cellpadding="0" class="t1">
  <tbody>
    <tr>
      <td valign="middle" class="td1">
        <p class="p3"><span class="s1">HostPC</span></p>
      </td>
      <td valign="middle" class="td2">
        <p class="p4"><span class="s1"></span><br></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td1">
        <p class="p3"><span class="s1">USB, WLAN</span></p>
      </td>
      <td valign="middle" class="td2">
        <p class="p4"><span class="s1"></span><br></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td1">
        <p class="p3"><span class="s1">Linux configfs, gadget, USB, WLAN drivers driver</span></p>
      </td>
      <td valign="middle" class="td2">
        <p class="p3"><span class="s1">wo ist config im git?</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td1">
        <p class="p3"><span class="s1">Apache Webserver</span></p>
      </td>
      <td valign="middle" class="td2">
        <p class="p4"><span class="s1"></span><br></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td1">
        <p class="p3"><span class="s1">PHP</span></p>
      </td>
      <td valign="middle" class="td2">
        <p class="p4"><span class="s1"></span><br></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td1">
        <p class="p3"><span class="s1">Retrode-PHP-Scripts (/var/www/html)</span></p>
      </td>
      <td valign="middle" class="td2">
        <p class="p3"><span class="s1">wo im git?</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td1">
        <p class="p3"><span class="s1">Shell-Scripts (/usr/local/bin)</span></p>
      </td>
      <td valign="middle" class="td2">
        <p class="p3"><span class="s1">wo im git?</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td1">
        <p class="p3"><span class="s1">Binary Tools (/usr/local/bin, /root, /usr/bin, /bin, /sbin etc.)</span></p>
      </td>
      <td valign="middle" class="td2">
        <p class="p3"><span class="s1">incl. gepatcher Sanni-Software bzw. ucon64 -&gt; wo im git?</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td1">
        <p class="p3"><span class="s1">Linux-Kernel-Syscalls</span></p>
      </td>
      <td valign="middle" class="td2">
        <p class="p3"><span class="s1">open, close, lseek, read, write etc.</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td1">
        <p class="p3"><span class="s1">Retrode3-Kernel Driver</span></p>
      </td>
      <td valign="middle" class="td2">
        <p class="p3"><span class="s1">wo im git?</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td1">
        <p class="p3"><span class="s1">Linux-Kernel Core-Libraries</span></p>
      </td>
      <td valign="middle" class="td2">
        <p class="p3"><span class="s1">e.g. gpiolib, i2c, mmc core</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td1">
        <p class="p3"><span class="s1">Processor GPIO registers</span></p>
      </td>
      <td valign="middle" class="td2">
        <p class="p4"><span class="s1"></span><br></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td1">
        <p class="p3"><span class="s1">Data and Address bus</span></p>
      </td>
      <td valign="middle" class="td2">
        <p class="p4"><span class="s1"></span><br></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td1">
        <p class="p3"><span class="s1">Connectors</span></p>
      </td>
      <td valign="middle" class="td2">
        <p class="p4"><span class="s1"></span><br></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td1">
        <p class="p3"><span class="s1">Cart &amp; Game-Controller</span></p>
      </td>
      <td valign="middle" class="td2">
        <p class="p4"><span class="s1"></span><br></p>
      </td>
    </tr>
  </tbody>
</table>
<p class="p4"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><b>2.1 Tools Documentation</b></span></p>
<p class="p3"><span class="s1">These tools are located in /usr/local/bin/retrode.</span></p>
<p class="p4"><span class="s1"></span><br></p>
<p class="p5"><span class="s1"><b>2.1.1 retrode-admin</b></span></p>
<p class="p3"><span class="s1">A shell script to controls OS upgrades and reboot.</span></p>
<p class="p6"><span class="s1"></span><br></p>
<p class="p5"><span class="s1"><b>2.1.2 retrode-dump</b></span></p>
<p class="p3"><span class="s1">A shel script to dump raw headers of carts.</span></p>
<p class="p6"><span class="s1"></span><br></p>
<p class="p5"><span class="s1"><b>2.1.3 retrode-info</b></span></p>
<p class="p2"><span class="s1">A shell script to detect current cart and report the game that was found in the database.</span></p>
<p class="p6"><span class="s1"></span><br></p>
<p class="p7"><span class="s1">root@letux:~# /usr/local/bin//retrode-info /dev/slot-md</span></p>
<p class="p7"><span class="s1">Sonic 3 (Europe)</span></p>
<p class="p7"><span class="s1">root@letux:~#</span></p>
<p class="p4"><span class="s1"></span><br></p>
<p class="p5"><span class="s1"><b>2.1.4 retrode-read</b></span></p>
<p class="p3"><span class="s1">A shell script that read a Cart contents onto the µSD.</span></p>
<p class="p6"><span class="s1"></span><br></p>
<p class="p5"><span class="s1"><b>2.1.5 retrode-wlan</b></span></p>
<p class="p2"><span class="s1">A shell script that controls WLAN.</span></p>
<p class="p6"><span class="s1"></span><br></p>
<p class="p5"><span class="s1"><b>2.1.6 retrode</b></span></p>
<p class="p2"><span class="s1">a command line tool based on a modified OSCR software. It tries to simulate the</span></p>
<p class="p2"><span class="s1">display and buttons of the OSCR software as good as possible.</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p7"><span class="s1">Usage: retrode [-h] [-e eeprom.bin] [-r sd-root] [command parameters ...]</span></p>
<p class="p7"><span class="s1">Options:</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">  </span>-h <span class="Apple-converted-space">            </span>Display this information</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">  </span>-e eeprom.bin<span class="Apple-converted-space">  </span>Define the eeprom file [default: "/usr/local/games/retrode/EEPROM.bin"]</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">  </span>-r sd-root <span class="Apple-converted-space">    </span>Define the SD root directory [default: "/usr/local/games/retrode"]</span></p>
<p class="p9"><span class="s1"></span><br></p>
<p class="p7"><span class="s1">The eeprom file is used to store e.g.</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">  </span>folder number</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">  </span>cart mode (NES)</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">  </span>mapper (NES)</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">  </span>newmapper (NES)</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">  </span>prgsize (NES)</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">  </span>chrsize (NES)</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">  </span>ramsize (NES)</span></p>
<p class="p9"><span class="s1"></span><br></p>
<p class="p7"><span class="s1">Menu choices are numbers. Multiple choices of subsequent submenus can be</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space"> </span>concatenated into a single command</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space"> </span>Choose the 'Reset' item to exit this tool</span></p>
<p class="p9"><span class="s1"></span><br></p>
<p class="p7"><span class="s1">Example:</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space"> </span>echo 200 | /usr/local/bin/retrode</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space"> </span>some echo commands to use:</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">  </span>echo 100<span class="Apple-converted-space">      </span>read SNES/SFC cart to file</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">  </span>echo 200<span class="Apple-converted-space">      </span>read Megadrive cart to file</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">  </span>echo 210<span class="Apple-converted-space">      </span>backup Sega RamCart to file</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p2"><span class="s1"><b>How it works.</b></span></p>
<p class="p2"><span class="s1">You won't want to know :) The Arduino code is <a href="https://en.wikipedia.org/wiki/Spaghetti_code"><span class="s2">https://en.wikipedia.org/wiki/Spaghetti_code</span></a>.</span></p>
<p class="p2"><span class="s1">And the way how the arduino .ino files are compiled must be replicated by copying them all into a</span></p>
<p class="p2"><span class="s1">single .cpp file, merge it with a retrode.cpp main() program and add some hacks and patches with</span></p>
<p class="p2"><span class="s1">#ifdef __Linux__ into the code. Fortunately we have done this for you and there is a Makefile that</span></p>
<p class="p2"><span class="s1">does most of these tasks. Of course it may have bugs and although it is possible to rebase the</span></p>
<p class="p2"><span class="s1">patches on top of the latest OSCR code, it may fail to compile or work. So beware the bug...</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p2"><span class="s1">And remember that this is very fragile. So you are welcome to provide suggestions for code</span></p>
<p class="p2"><span class="s1">improvements but do not expect that they are re accepted or integrated without deep discussions.</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p2"><span class="s1">A final note: since it is necessary to build MIPS-ELF code running on Linux and we do not assume</span></p>
<p class="p2"><span class="s1">that you have a cross-compiler, install and run g++ on the Retrode. This is where having Embedded</span></p>
<p class="p2"><span class="s1">Linux inside pays off.</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p10"><span class="s3"><b>Original git:</b> <a href="https://github.com/sanni/cartreader/tree/master/Cart_Reader"><span class="s4">https://github.com/sanni/cartreader/tree/master/Cart_Reader</span></a></span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p10"><span class="s3"><b>Retrode3 git</b> with patches: <a href="ssh://_git@git.goldelico.com/retrode3.git"><span class="s4">ssh://_git@git.goldelico.com/retrode3.git</span></a></span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p2"><span class="s1"><b>How to build</b> (on device):</span></p>
<p class="p2"><span class="s1">1. log into device (through USB console or ssh)</span></p>
<p class="p2"><span class="s1">2. apt-get update &amp;&amp; apt-get install git g++</span></p>
<p class="p2"><span class="s1">3. mkdir -p /usr/local/src &amp;&amp; cd /usr/local/src</span></p>
<p class="p2"><span class="s1">3. git clone <a href="ssh://_git@git.goldelico.com/retrode3.git"><span class="s5">ssh://_git@git.goldelico.com/retrode3.git</span></a> retrode<span class="Apple-converted-space">  </span>--- da fehlt noch was damit wir nur das Unterverzeichnis Cart_Reader auschecken</span></p>
<p class="p2"><span class="s1">4. cd retrode</span></p>
<p class="p2"><span class="s1">5. make</span></p>
<p class="p2"><span class="s1">Copy result from /usr/local/src/retrode to where you prefer.</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p2"><span class="s1"><b>How to start remote build</b> (on device) from a host: PC</span></p>
<p class="p10"><span class="s3">1. git clone <a href="ssh://_git@git.goldelico.com/retrode3.git"><span class="s4">ssh://_git@git.goldelico.com/retrode3.git</span></a> retrode</span></p>
<p class="p2"><span class="s1">2. cd retrode/Cart_Reader</span></p>
<p class="p2"><span class="s1">3. make remote</span></p>
<p class="p2"><span class="s1">4. the binary will be in the current directory</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p5"><span class="s1"><b>2.1.7 ucon64</b></span></p>
<p class="p4"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><b>2.2 Kernel Documentation</b></span></p>
<p class="p3"><span class="s1">The kernel is an LetuxOS kernel (currently 6.16-rc5) for the Lumissil X1600 with</span></p>
<p class="p3"><span class="s1">some application specific changes to the device tree and a special driver for the</span></p>
<p class="p3"><span class="s1">slots and busses.</span></p>
<p class="p4"><span class="s1"></span><br></p>
<p class="p11"><span class="s1"><b>2.2.1 Kernel Files</b></span></p>
<p class="p4"><span class="s1"></span><br></p>
<p class="p3"><span class="s1"><b>/dev/slot-md /dev/slot-nes /dev/slot-snes</b></span></p>
<p class="p4"><span class="s1"></span><br></p>
<p class="p3"><span class="s1">allows direct access to the carts. Please beware that some read modes need</span></p>
<p class="p3"><span class="s1">C-Code doing open(), lseek(address + flags), read().</span></p>
<p class="p4"><span class="s1"></span><br></p>
<p class="p3"><span class="s1">This can be used (with some knowledge) to read out raw data:</span></p>
<p class="p4"><span class="s1"></span><br></p>
<p class="p7"><span class="s1">root@letux:~# xxd -s 256 -l 256 /dev/slot-md</span></p>
<p class="p7"><span class="s1">0000100: 5345 4741 2047 454e 4553 4953 2020 2020<span class="Apple-converted-space">  </span>SEGA GENESIS <span class="Apple-converted-space">   </span></span></p>
<p class="p7"><span class="s1">0000110: 2843 2953 4547 4120 3139 3933 2e4e 4f56<span class="Apple-converted-space">  </span>(C)SEGA 1993.NOV</span></p>
<p class="p7"><span class="s1">0000120: 534f 4e49 4320 5448 4520 2020 2020 2020<span class="Apple-converted-space">  </span>SONIC THE<span class="Apple-converted-space">       </span></span></p>
<p class="p7"><span class="s1">0000130: 2020 2020 2020 4845 4447 4548 4f47 2033<span class="Apple-converted-space">        </span>HEDGEHOG 3</span></p>
<p class="p7"><span class="s1">0000140: 2020 2020 2020 2020 2020 2020 2020 2020 <span class="Apple-converted-space">                 </span></span></p>
<p class="p7"><span class="s1">0000150: 534f 4e49 4320 5448 4520 2020 2020 2020<span class="Apple-converted-space">  </span>SONIC THE<span class="Apple-converted-space">       </span></span></p>
<p class="p7"><span class="s1">0000160: 2020 2020 2020 4845 4447 4548 4f47 2033<span class="Apple-converted-space">        </span>HEDGEHOG 3</span></p>
<p class="p7"><span class="s1">0000170: 2020 2020 2020 2020 2020 2020 2020 2020 <span class="Apple-converted-space">                 </span></span></p>
<p class="p7"><span class="s1">0000180: 474d 204d 4b2d 3130 3739 202d 3030 a8f2<span class="Apple-converted-space">  </span>GM MK-1079 -00..</span></p>
<p class="p7"><span class="s1">0000190: 4a20 2020 2020 2020 2020 2020 2020 2020<span class="Apple-converted-space">  </span>J<span class="Apple-converted-space">               </span></span></p>
<p class="p7"><span class="s1">00001a0: 0000 0000 001f ffff 00ff 0000 00ff ffff<span class="Apple-converted-space">  </span>................</span></p>
<p class="p7"><span class="s1">00001b0: 5241 f820 0020 0001 0020 03ff 2020 2020<span class="Apple-converted-space">  </span>RA. . ... .. <span class="Apple-converted-space">   </span></span></p>
<p class="p7"><span class="s1">00001c0: 2020 2020 2020 2020 0001 2020 2020 2020<span class="Apple-converted-space">          </span>.. <span class="Apple-converted-space">     </span></span></p>
<p class="p7"><span class="s1">00001d0: 0020 0000 003f ffff 0020 0001 0020 03ff<span class="Apple-converted-space">  </span>. ...?... ... ..</span></p>
<p class="p7"><span class="s1">00001e0: 2020 2020 2020 2020 2020 2020 2020 2020 <span class="Apple-converted-space">                 </span></span></p>
<p class="p7"><span class="s1">00001f0: 4520 2020 2020 2020 2020 2020 2020 2020<span class="Apple-converted-space">  </span>E<span class="Apple-converted-space">               </span></span></p>
<p class="p7"><span class="s1">root@letux:~#<span class="Apple-converted-space"> </span></span></p>
<p class="p4"><span class="s1"></span><br></p>
<p class="p3"><span class="s1">If no cart is plugged, the device returns -ENODEV.</span></p>
<p class="p4"><span class="s1"></span><br></p>
<p class="p2"><span class="s6"><b>/dev/input/left </b></span><span class="s1"><b>/dev/input/right /dev/input/event*</b></span></p>
<p class="p4"><span class="s1"></span><br></p>
<p class="p3"><span class="s1">This are standard Linux input ports which can be looked</span></p>
<p class="p3"><span class="s1">at with evtest.</span></p>
<p class="p3"><span class="s1">left and right only exist if a game controller is plugged in.</span></p>
<p class="p3"><span class="s1">(done through an udev rule).</span></p>
<p class="p4"><span class="s1"></span><br></p>
<p class="p3"><span class="s1"><b>/sys/class/retrode3</b></span></p>
<p class="p4"><span class="s1"></span><br></p>
<p class="p3"><span class="s1">For each slot there are properties:</span></p>
<p class="p4"><span class="s1"></span><br></p>
<p class="p12"><span class="s7">addr - for HW debugging</span></p>
<p class="p12"><span class="s7">data16 - for HW debugging</span></p>
<p class="p12"><span class="s7">data8 - for HW debugging</span></p>
<p class="p12"><span class="s7">sense - tells if slot is active or empty</span></p>
<p class="p12"><span class="s7">uevent - useful for udev rules</span></p>
<p class="p12"><span class="s7">vcc - the MD slot can be switched between 5000mV (5V) and 3300mV (3.3V)</span></p>
<p class="p4"><span class="s1"></span><br></p>
<p class="p3"><span class="s1"><b>2.2.2 Kernel Source code</b></span></p>
<p class="p4"><span class="s1"></span><br></p>
<p class="p3"><span class="s1">--- here some git repo</span></p>
<p class="p4"><span class="s1"></span><br></p>
<p class="p3"><span class="s1"><b>2.2.3 build kernel</b></span></p>
<p class="p4"><span class="s1"></span><br></p>
<p class="p3"><span class="s1"><b>2.2.4 Hardware debugging</b></span></p>
<p class="p4"><span class="s1"></span><br></p>
<p class="p3"><span class="s1">the addr, data8 and data16 properties allow to directly program the bus.</span></p>
<p class="p3"><span class="s1">To select the cart (and deselect all others including game controls) and</span></p>
<p class="p3"><span class="s1">choose address 147b:</span></p>
<p class="p4"><span class="s1"></span><br></p>
<p class="p12"><span class="s7">root@letux:~# echo 147b &gt;/sys/class/retrode3/slot-md/addr</span></p>
<p class="p12"><span class="s7">root@letux:~#<span class="Apple-converted-space"> </span></span></p>
<p class="p4"><span class="s1"></span><br></p>
<p class="p3"><span class="s1"><b>Then, you can read 8 bit (A0 resprected) or 16 bit (A0 ignored)</b></span></p>
<p class="p13"><span class="s1"></span><br></p>
<p class="p12"><span class="s7">root@letux:~# cat /sys/class/retrode3/slot-md/data8</span></p>
<p class="p12"><span class="s7">bc</span></p>
<p class="p12"><span class="s7">root@letux:~# cat /sys/class/retrode3/slot-md/data16</span></p>
<p class="p12"><span class="s7">2abc</span></p>
<p class="p12"><span class="s7">root@letux:~#<span class="Apple-converted-space"> </span></span></p>
<p class="p4"><span class="s1"></span><br></p>
<p class="p3"><span class="s1"><b>To deselect the cart (and standard operation or game controllers are blocked!)</b></span></p>
<p class="p12"><span class="s7">root@letux:~# echo deselect &gt;/sys/class/retrode3/slot-md/addr</span></p>
<p class="p12"><span class="s7">root@letux:~#<span class="Apple-converted-space"> </span></span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p3"><span class="s1"><b>2.2.5 U-Boot</b></span></p>
<p class="p3"><span class="s1">the Retrode uses the LX16E U-Boot:</span></p>
<p class="p4"><span class="s1"></span><br></p>
<p class="p3"><span class="s1"><a href="https://git.goldelico.com/?p=letux-uboot.git;a=tree">https://git.goldelico.com/?p=letux-uboot.git;a=tree<span class="s8"></span></a></span></p>
<p class="p3"><span class="s1"><a href="https://download.goldelico.com/letux-u-boot/Letux-X16E/latest/">https://download.goldelico.com/letux-u-boot/Letux-X16E/latest/<span class="s8"></span></a></span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p14"><span class="s1"><b>2.3 Debian Documentation</b></span></p>
<p class="p5"><span class="s1"><b>2.3.1 Debian Version</b></span></p>
<p class="p2"><span class="s1">The Retrode uses Debian 8 (Jessie) because it is still small and faster</span></p>
<p class="p2"><span class="s1">than systemd based code. But there is no other reason to stick to such</span></p>
<p class="p2"><span class="s1">an old distribution and Bookworm could also be adapted to be working.</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p5"><span class="s1"><b>2.3.2 Retrode Packages</b></span></p>
<p class="p2"><span class="s1">The Retrode OS uses some special debian packages:</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p12"><span class="s7">retrode-controller-gadget - the gadget driver to present the controllers as USB joysticks</span></p>
<p class="p12"><span class="s7">retrode-hidd - a daemon to translate Linux input events to USB HID events</span></p>
<p class="p12"><span class="s1">retrode-smb - configure SMB access for Retrode3</span></p>
<p class="p12"><span class="s7">retrode-tools - helper scripts that run as root</span></p>
<p class="p12"><span class="s7">retrode-udev-rules - udev rules to handle cart/game controller insertion/removal</span></p>
<p class="p12"><span class="s7">retrode-web-control - the web interface (PHP scripts)</span></p>
<p class="p12"><span class="s7">ucon64 - a tool to analyse Cart headers</span></p>
<p class="p12"><span class="s7">retrode3 - installs the binary that wraps the OSCR software into a command line tool</span></p>
<p class="p13"><span class="s1"></span><br></p>
<p class="p15"><span class="s9">The Retrode Repository is at: <a href="https://download.goldelico.com/quantumstep/debian+retrode/"><span class="s10">https://download.goldelico.com/quantumstep/debian+retrode/</span></a></span></p>
<p class="p16"><span class="s11"></span><br></p>
<p class="p17"><span class="s1">Sources are here: ...</span></p>
<p class="p16"><span class="s11"></span><br></p>
<p class="p17"><span class="s1">To rebuild from source you may need mySTEP.make and the xtc cross compiler toolchains</span></p>
<p class="p17"><span class="s1">for macOS but any other build system should be configurable to mimick that. Debian packages</span></p>
<p class="p17"><span class="s1">are described by the respective .qcodeproj files.</span></p>
<p class="p16"><span class="s1"></span><br></p>
<p class="p17"><span class="s1">mySTEP.make: <a href="https://git.goldelico.com/?p=mySTEP.git;a=blob;f=mySTEP.make;h=e7573034c17590bc1f1dde674f4e56da26201856;hb=refs/heads/master"><span class="s12">https://git.goldelico.com/?p=mySTEP.git;a=blob;f=mySTEP.make</span></a></span></p>
<p class="p18"><span class="s1"></span><br></p>
<p class="p5"><span class="s1"><b>2.3.3 LetuxOS Packages</b></span></p>
<p class="p2"><span class="s1">More packages are installed from the Letux repository.</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p12"><span class="s7">letux-gadget - the gadget configuration core for the USB port</span></p>
<p class="p12"><span class="s7">letux-ip-over-usb-gadget - allows RNDIS etc.</span></p>
<p class="p12"><span class="s7">letux-tty-gadget - opens a serial port over USB</span></p>
<p class="p12"><span class="s7">letux-smb - allow SMB access to the device</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p19"><span class="s9">The Letux Repository at: <a href="https://download.goldelico.com/letux-debian-rootfs/debian"><span class="s13">https://download.goldelico.com/letux-debian-rootfs/debian</span></a></span></p>
<p class="p13"><span class="s1"></span><br></p>
<p class="p17"><span class="s1">Sources are here: <a href="https://git.goldelico.com/?p=letux-rootfs.git;a=tree;f=packages;h=e7d22a8a705b85386b5da20982c170e0537a90bc;hb=HEAD"><span class="s12">https://git.goldelico.com/?p=letux-rootfs.git;a=tree;f=packages</span></a></span></p>
<p class="p13"><span class="s1"></span><br></p>
<p class="p14"><span class="s1"><b>2.4 Installation</b></span></p>
<p class="p2"><span class="s1">Take a fresh µSD card into a host computer card reader.</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p19"><span class="s9">Download makesd: <a href="https://projects.goldelico.com/p/gta04-makesd/"><span class="s13">https://projects.goldelico.com/p/gta04-makesd</span></a></span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p2"><span class="s1">Run (may need to run as root user to have access to the SD reader):</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p12"><span class="s8">$ </span><span class="s7">DEV=/dev/sdb /usr/local/bin/makesd retrode3</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p2"><span class="s1">Please replace the </span><span class="s14">/dev/sdb</span><span class="s1"> by the Linux device name of your µSD card reader.</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p2"><span class="s1">Temporarily: install kernel, device tree and modules from</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p2"><span class="s1"><a href="https://download.goldelico.com/letux-kernel/">https://download.goldelico.com/letux-kernel/</a>???</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p2"><span class="s1">Then plug the µSD into the Retrode3 and power it on.</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p2"><span class="s1">Ideally, you should then run an OS Upgrade from the Settings menu but</span></p>
<p class="p2"><span class="s1">that is not strictly necessary for the first steps.</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p14"><span class="s1"><b>2.5 WLAN and BLE</b></span></p>
<p class="p2"><span class="s1">WLAN (and BLE) is provided by an ESP32-WROOM6.</span></p>
<p class="p2"><span class="s1">The esp-hosted-ng driver is included in the LetuxOS kernels.</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p2"><span class="s1">The retrode boards come with (withoug?) flashed firmware. So</span></p>
<p class="p2"><span class="s1">there is usually no need to update.</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p5"><span class="s1"><b>2.5.1 Installation of the ESP firmware</b></span></p>
<p class="p2"><span class="s1">There is a special tool letux-esp-serial-flasher that must be</span></p>
<p class="p2"><span class="s1">installed on the board through</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p12"><span class="s7">root@letux:~# apt-get update</span></p>
<p class="p12"><span class="s7">root@letux:~# apt-get install letux-esp-serial-flasher</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p2"><span class="s1">Then run</span></p>
<p class="p13"><span class="s1"></span><br></p>
<p class="p12"><span class="s7">root@letux:~# /usr/local/bin/mipsel-linux-gnu/esp-flasher</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p2"><span class="s1">It will directly control the ESP32 to bring the boot ROM into</span></p>
<p class="p2"><span class="s1">flashing mode. Then, it will send the binaries though an UART</span></p>
<p class="p2"><span class="s1">into the ESP32.</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p2"><span class="s1">This process takes approx. 2 minutes.</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p5"><span class="s1"><b>2.5.2 Testing WLAN from command line</b></span></p>
<p class="p2"><span class="s1">Afterwards WLAN should work:</span></p>
<p class="p12"><span class="s7">/root/wlan-scan</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p5"><span class="s1"><b>2.5.3 testing BLE from command line</b></span></p>
<p class="p2"><span class="s1">BLE is not yet used by the Retrode3.</span></p>
<p class="p12"><span class="s1">/root/ble-scan</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p14"><span class="s1"><b>2.6 Web Interface</b></span></p>
<p class="p5"><span class="s1"><b>2.6.1 Concept</b></span></p>
<p class="p2"><span class="s1">The Retrode runs an Apache web server with PHP and the user interface</span></p>
<p class="p2"><span class="s1">is provided through html, php and jpeg files stored in /var/www/html/.</span></p>
<p class="p2"><span class="s1">&lt;a&gt; tags, &lt;form&gt; and POST/GET parameters are used to control different</span></p>
<p class="p2"><span class="s1">actions, like menu choice, Extract Cart data, connect to WLAN etc.</span></p>
<p class="p2"><span class="s1">PHP can run some scripts from /usr/local/bin/retrode. If these scripts</span></p>
<p class="p2"><span class="s1">need root access (and most do), the binaries must be listed in /etc/sudoers.d</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p5"><span class="s1"><b>2.6.2 Room for improvement...</b></span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p2"><span class="s1">State is stored where for:</span></p>
<p class="p2"><span class="s1">- default WLAN connections?</span></p>
<p class="p2"><span class="s1">- User language?</span></p>
<p class="p2"><span class="s1">- Time Zone of user interface?</span></p>
<p class="p2"><span class="s1">=&gt; On File System (µSD) or in Cookies (or both)?</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p2"><span class="s1">Currenty, JavaScript or CSS are not used.</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p2"><span class="s1">To make background activities visible (e.g. the waiting time during Extract</span></p>
<p class="p2"><span class="s1">or connecting to WLAN), JavaScript could show an animation (e.g. progress bar).</span></p>
<p class="p2"><span class="s1">And, web pages should self-refresh after activity is completed.</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p2"><span class="s1">A really open question is if there is some WebGUI-Toolkit that can be used</span></p>
<p class="p2"><span class="s1">here instead of plain PHP and HTML.</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p10"><span class="s3">How is a <a href="https://fritz.com/service/wissensdatenbank/dok/FRITZ-Box-5491/1_Benutzeroberflache-der-FRITZ-Box-aufrufen/"><span class="s4">FritzBox providing their WebGUI</span></a>? Freetz-NG??</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><b>3. Hardware</b></span></p>
<p class="p14"><span class="s1"><b>3.1 Schematics</b></span></p>
<p class="p5"><span class="s1"><b>3.1.1 Background</b></span></p>
<p class="p2"><span class="s1">The hardware design is a mix of the</span></p>
<p class="p2"><span class="s1">- LX16 (x1600 controller, USB, µSD, Power regulators, ESP32),</span></p>
<p class="p2"><span class="s1">- Retrode 2 (connectors, bus concept for carts and game controllers),</span></p>
<p class="p2"><span class="s1">- OSCR hardware designs (NES control, Si5351 clock generator)</span></p>
<p class="p2"><span class="s1">plus additions and modifications.</span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p5"><span class="s1"><b>3.1.2 Room for improvement...</b></span></p>
<p class="p8"><span class="s1"></span><br></p>
<p class="p14"><span class="s1"><b>3.2 Hardware hacking</b></span></p>
<p class="p5"><span class="s1"><b>3.2.1 adding an FTDI console connector</b></span></p>
<p class="p2"><span class="s1">Solder a 6 pin header (e.g. AdamTech PH1-06-UA or similar)</span></p>
<p class="p2"><span class="s1">to the left solder holes of the µSD reader.</span></p>
<p class="p2"><span class="s1">Connect a standard or compatible 6-pin 3.3V FTDI to USB</span></p>
<p class="p2"><span class="s1">adapter. The small golden Triangle on the PCB shows where</span></p>
<p class="p2"><span class="s1">the GND pin (black wire) should be connected.</span></p>
<p class="p2"><span class="s1">&lt;&lt; Foto? &gt;&gt;</span></p>
<p class="p2"><span class="s1">You get direct root access (user: root, empty password:).</span></p>
<p class="p6"><span class="s1"></span><br></p>
</body>
</html>
