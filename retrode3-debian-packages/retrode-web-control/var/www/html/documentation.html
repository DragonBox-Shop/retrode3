<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2487.7">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 18.0px Helvetica; -webkit-text-stroke: #29f20a}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; -webkit-text-stroke: #29f20a; min-height: 14.0px}
    p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; -webkit-text-stroke: #29f20a}
    p.p4 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Helvetica; -webkit-text-stroke: #000000}
    p.p5 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; -webkit-text-stroke: #000000}
    p.p6 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Helvetica; -webkit-text-stroke: #000000; min-height: 17.0px}
    p.p7 {margin: 0.0px 0.0px 0.0px 0.0px; font: 11.0px Monaco; -webkit-text-stroke: #000000}
    p.p8 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Helvetica; -webkit-text-stroke: #29f20a}
    p.p9 {margin: 0.0px 0.0px 0.0px 0.0px; font: 10.0px Monaco; -webkit-text-stroke: #000000}
    p.p10 {margin: 0.0px 0.0px 0.0px 0.0px; font: 10.0px Monaco; -webkit-text-stroke: #000000; min-height: 14.0px}
    p.p11 {margin: 0.0px 0.0px 0.0px 0.0px; font: 18.0px Helvetica; -webkit-text-stroke: #000000; min-height: 22.0px}
    p.p12 {margin: 0.0px 0.0px 0.0px 0.0px; font: 18.0px Helvetica; -webkit-text-stroke: #000000}
    p.p13 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; -webkit-text-stroke: #000000; min-height: 14.0px}
    p.p14 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; color: #0000e9; -webkit-text-stroke: #000000}
    span.s1 {font-kerning: none}
    span.s2 {font-kerning: none; -webkit-text-stroke: 0px #29f20a}
    span.s3 {font-kerning: none; font-variant-ligatures: common-ligatures}
    span.s4 {font-kerning: none; color: #000000}
    span.s5 {text-decoration: underline ; font-kerning: none}
    span.s6 {font: 12.0px Helvetica; font-kerning: none}
    table.t1 {border-collapse: collapse}
    td.td1 {width: 310.0px; border-style: solid; border-width: 1.0px 1.0px 1.0px 1.0px; border-color: #b2b2b2 #b2b2b2 #b2b2b2 #b2b2b2; padding: 0.0px 5.0px 0.0px 5.0px}
    td.td2 {width: 317.0px; border-style: solid; border-width: 1.0px 1.0px 1.0px 1.0px; border-color: #b2b2b2 #b2b2b2 #b2b2b2 #b2b2b2; padding: 0.0px 5.0px 0.0px 5.0px}
  </style>
</head>
<body>
<p class="p1"><span class="s1"><b>1. User Documentation</b></span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><b>2. System architecture</b></span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p3"><span class="s1">Software layers:</span></p>
<table cellspacing="0" cellpadding="0" class="t1">
  <tbody>
    <tr>
      <td valign="middle" class="td1">
        <p class="p3"><span class="s1">HostPC</span></p>
      </td>
      <td valign="middle" class="td2">
        <p class="p2"><span class="s1"></span><br></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td1">
        <p class="p3"><span class="s1">USB, WLAN</span></p>
      </td>
      <td valign="middle" class="td2">
        <p class="p2"><span class="s1"></span><br></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td1">
        <p class="p3"><span class="s1">Linux configfs, gadget, USB, WLAN drivers driver</span></p>
      </td>
      <td valign="middle" class="td2">
        <p class="p3"><span class="s1">wo ist config im git?</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td1">
        <p class="p3"><span class="s1">Apache Webserver</span></p>
      </td>
      <td valign="middle" class="td2">
        <p class="p2"><span class="s1"></span><br></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td1">
        <p class="p3"><span class="s1">PHP</span></p>
      </td>
      <td valign="middle" class="td2">
        <p class="p2"><span class="s1"></span><br></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td1">
        <p class="p3"><span class="s1">Retrode-PHP-Scripts (/var/www/html)</span></p>
      </td>
      <td valign="middle" class="td2">
        <p class="p3"><span class="s1">wo im git?</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td1">
        <p class="p3"><span class="s1">Shell-Scripts (/usr/local/bin)</span></p>
      </td>
      <td valign="middle" class="td2">
        <p class="p3"><span class="s1">wo im git?</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td1">
        <p class="p3"><span class="s1">Binary Tools (/usr/local/bin, /root, /usr/bin, /bin, /sbin etc.)</span></p>
      </td>
      <td valign="middle" class="td2">
        <p class="p3"><span class="s1">incl. gepatcher Sanni-Software bzw. ucon64 -&gt; wo im git?</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td1">
        <p class="p3"><span class="s1">Linux-Kernel-Syscalls</span></p>
      </td>
      <td valign="middle" class="td2">
        <p class="p3"><span class="s1">open, close, lseek, read, write etc.</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td1">
        <p class="p3"><span class="s1">Retrode3-Kernel Driver</span></p>
      </td>
      <td valign="middle" class="td2">
        <p class="p3"><span class="s1">wo im git?</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td1">
        <p class="p3"><span class="s1">Linux-Kernel Core-Libraries</span></p>
      </td>
      <td valign="middle" class="td2">
        <p class="p3"><span class="s1">e.g. gpiolib, i2c, mmc core</span></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td1">
        <p class="p3"><span class="s1">Processor GPIO registers</span></p>
      </td>
      <td valign="middle" class="td2">
        <p class="p2"><span class="s1"></span><br></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td1">
        <p class="p3"><span class="s1">Data and Address bus</span></p>
      </td>
      <td valign="middle" class="td2">
        <p class="p2"><span class="s1"></span><br></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td1">
        <p class="p3"><span class="s1">Connectors</span></p>
      </td>
      <td valign="middle" class="td2">
        <p class="p2"><span class="s1"></span><br></p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td1">
        <p class="p3"><span class="s1">Cart &amp; Game-Controller</span></p>
      </td>
      <td valign="middle" class="td2">
        <p class="p2"><span class="s1"></span><br></p>
      </td>
    </tr>
  </tbody>
</table>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><b>2.1 Tools Documentation</b></span></p>
<p class="p4"><span class="s1"><b>2.1.1 retrode-admin</b></span></p>
<p class="p3"><span class="s1">Controls OS upgrades and Reboot.</span></p>
<p class="p4"><span class="s1"><b>2.1.2 retrode-dump</b></span></p>
<p class="p3"><span class="s1">Dump raw header of cart.</span></p>
<p class="p4"><span class="s1"><b>2.1.3 retrode-info</b></span></p>
<p class="p5"><span class="s1">Detect current cart and report the game that was found in the database.</span></p>
<p class="p6"><span class="s1"></span><br></p>
<p class="p7"><span class="s1">root@letux:~# /usr/local/bin//retrode-info /dev/slot-md</span></p>
<p class="p7"><span class="s1">Sonic 3 (Europe)</span></p>
<p class="p7"><span class="s1">root@letux:~#</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><b>2.1.4 retrode-read</b></span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><b>2.1.5 retrode-wlan</b></span></p>
<p class="p5"><span class="s1">Controls WLAN.</span></p>
<p class="p4"><span class="s1"><b>2.1.6 ucon64</b></span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><b>2.2 Kernel Documentation</b></span></p>
<p class="p3"><span class="s1">The kernel is an LetuxOS kernel (currently 6.16-rc5) for the Lumissil X1600 with</span></p>
<p class="p3"><span class="s1">some application specific changes to the device tree and a special driver for the</span></p>
<p class="p3"><span class="s1">slots and busses.</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p8"><span class="s1"><b>2.2.1 Kernel Files</b></span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p3"><span class="s1"><b>/dev/slot-md /dev/slot-nes /dev/slot-snes</b></span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p3"><span class="s1">allows direct access to the carts. Please beware that some read modes need</span></p>
<p class="p3"><span class="s1">C-Code doing open(), lseek(address + flags), read().</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p3"><span class="s1">This can be used (with some knowledge) to read out raw data:</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p7"><span class="s1">root@letux:~# xxd -s 256 -l 256 /dev/slot-md</span></p>
<p class="p7"><span class="s1">0000100: 5345 4741 2047 454e 4553 4953 2020 2020<span class="Apple-converted-space">  </span>SEGA GENESIS <span class="Apple-converted-space">   </span></span></p>
<p class="p7"><span class="s1">0000110: 2843 2953 4547 4120 3139 3933 2e4e 4f56<span class="Apple-converted-space">  </span>(C)SEGA 1993.NOV</span></p>
<p class="p7"><span class="s1">0000120: 534f 4e49 4320 5448 4520 2020 2020 2020<span class="Apple-converted-space">  </span>SONIC THE<span class="Apple-converted-space">       </span></span></p>
<p class="p7"><span class="s1">0000130: 2020 2020 2020 4845 4447 4548 4f47 2033<span class="Apple-converted-space">        </span>HEDGEHOG 3</span></p>
<p class="p7"><span class="s1">0000140: 2020 2020 2020 2020 2020 2020 2020 2020 <span class="Apple-converted-space">                 </span></span></p>
<p class="p7"><span class="s1">0000150: 534f 4e49 4320 5448 4520 2020 2020 2020<span class="Apple-converted-space">  </span>SONIC THE<span class="Apple-converted-space">       </span></span></p>
<p class="p7"><span class="s1">0000160: 2020 2020 2020 4845 4447 4548 4f47 2033<span class="Apple-converted-space">        </span>HEDGEHOG 3</span></p>
<p class="p7"><span class="s1">0000170: 2020 2020 2020 2020 2020 2020 2020 2020 <span class="Apple-converted-space">                 </span></span></p>
<p class="p7"><span class="s1">0000180: 474d 204d 4b2d 3130 3739 202d 3030 a8f2<span class="Apple-converted-space">  </span>GM MK-1079 -00..</span></p>
<p class="p7"><span class="s1">0000190: 4a20 2020 2020 2020 2020 2020 2020 2020<span class="Apple-converted-space">  </span>J<span class="Apple-converted-space">               </span></span></p>
<p class="p7"><span class="s1">00001a0: 0000 0000 001f ffff 00ff 0000 00ff ffff<span class="Apple-converted-space">  </span>................</span></p>
<p class="p7"><span class="s1">00001b0: 5241 f820 0020 0001 0020 03ff 2020 2020<span class="Apple-converted-space">  </span>RA. . ... .. <span class="Apple-converted-space">   </span></span></p>
<p class="p7"><span class="s1">00001c0: 2020 2020 2020 2020 0001 2020 2020 2020<span class="Apple-converted-space">          </span>.. <span class="Apple-converted-space">     </span></span></p>
<p class="p7"><span class="s1">00001d0: 0020 0000 003f ffff 0020 0001 0020 03ff<span class="Apple-converted-space">  </span>. ...?... ... ..</span></p>
<p class="p7"><span class="s1">00001e0: 2020 2020 2020 2020 2020 2020 2020 2020 <span class="Apple-converted-space">                 </span></span></p>
<p class="p7"><span class="s1">00001f0: 4520 2020 2020 2020 2020 2020 2020 2020<span class="Apple-converted-space">  </span>E<span class="Apple-converted-space">               </span></span></p>
<p class="p7"><span class="s1">root@letux:~#<span class="Apple-converted-space"> </span></span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p3"><span class="s1">If no cart is plugged, the device returns -ENODEV.</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p5"><span class="s2"><b>/dev/input/left </b></span><span class="s1"><b>/dev/input/right /dev/input/event*</b></span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p3"><span class="s1">This are standard Linux input ports which can be looked</span></p>
<p class="p3"><span class="s1">at with evtest.</span></p>
<p class="p3"><span class="s1">left and right only exist if a game controller is plugged in.</span></p>
<p class="p3"><span class="s1">(done through an udev rule).</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p3"><span class="s1"><b>/sys/class/retrode3</b></span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p3"><span class="s1">For each slot there are properties:</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p9"><span class="s3">addr - for HW debugging</span></p>
<p class="p9"><span class="s3">data16 - for HW debugging</span></p>
<p class="p9"><span class="s3">data8 - for HW debugging</span></p>
<p class="p9"><span class="s3">sense - tells if slot is active or empty</span></p>
<p class="p9"><span class="s3">uevent - useful for udev rules</span></p>
<p class="p9"><span class="s3">vcc - the MD slot can be switched between 5000mV (5V) and 3300mV (3.3V)</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p3"><span class="s1"><b>2.2.2 Kernel Source code</b></span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p3"><span class="s1">--- here some git repo</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p3"><span class="s1"><b>2.2.3 build kernel</b></span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p3"><span class="s1"><b>2.2.4 Hardware debugging</b></span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p3"><span class="s1">the addr, data8 and data16 properties allow to directly program the bus.</span></p>
<p class="p3"><span class="s1">To select the cart (and deselect all others including game controls) and</span></p>
<p class="p3"><span class="s1">choose address 147b:</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p9"><span class="s3">root@letux:~# echo 147b &gt;/sys/class/retrode3/slot-md/addr</span></p>
<p class="p9"><span class="s3">root@letux:~#<span class="Apple-converted-space"> </span></span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p3"><span class="s1"><b>Then, you can read 8 bit (A0 resprected) or 16 bit (A0 ignored)</b></span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p9"><span class="s3">root@letux:~# cat /sys/class/retrode3/slot-md/data8</span></p>
<p class="p9"><span class="s3">bc</span></p>
<p class="p9"><span class="s3">root@letux:~# cat /sys/class/retrode3/slot-md/data16</span></p>
<p class="p9"><span class="s3">2abc</span></p>
<p class="p9"><span class="s3">root@letux:~#<span class="Apple-converted-space"> </span></span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p3"><span class="s1"><b>To deselect the cart (and standard operation or game controllers are blocked!)</b></span></p>
<p class="p9"><span class="s3">root@letux:~# echo deselect &gt;/sys/class/retrode3/slot-md/addr</span></p>
<p class="p9"><span class="s3">root@letux:~#<span class="Apple-converted-space"> </span></span></p>
<p class="p11"><span class="s1"></span><br></p>
<p class="p12"><span class="s1"><b>2.3 Debian Documentation</b></span></p>
<p class="p4"><span class="s1"><b>2.3.1 Debian Version</b></span></p>
<p class="p5"><span class="s1">The Retrode uses Debian 8 (Jessie) because it is still small and faster</span></p>
<p class="p5"><span class="s1">than systemd based code. But there is no other reason to stick to such</span></p>
<p class="p5"><span class="s1">an old distribution and Bookworm could also be adapted to be working.</span></p>
<p class="p4"><span class="s1"><b>2.3.2 Retrode Packages</b></span></p>
<p class="p5"><span class="s1">The Retrode OS uses some special debian packages:</span></p>
<p class="p13"><span class="s1"></span><br></p>
<p class="p9"><span class="s3">retrode-controller-gadget - the gadget driver to present the controllers as USB joysticks</span></p>
<p class="p9"><span class="s3">retrode-hidd - a daemon to translate Linux input events to USB HID events</span></p>
<p class="p9"><span class="s3">retrode-tools - helper scripts that run as root</span></p>
<p class="p9"><span class="s3">retrode-udev-rules - udev rules to handle cart/game controller insertion/removal</span></p>
<p class="p9"><span class="s3">retrode-web-control - the web interface (PHP scripts)</span></p>
<p class="p9"><span class="s3">ucon64 - a tool to analyse Cart headers</span></p>
<p class="p9"><span class="s3">retrode3 - installs the binary that wraps the OSCR software into a command line tool</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p14"><span class="s4">The Retrode Repository is at: <a href="https://download.goldelico.com/quantumstep/debian+retrode/"><span class="s5">https://download.goldelico.com/quantumstep/debian+retrode/</span></a></span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><b>2.3.3 LetuxOS Packages</b></span></p>
<p class="p5"><span class="s1">More packages are installed from the Letux repository.</span></p>
<p class="p13"><span class="s1"></span><br></p>
<p class="p9"><span class="s3">letux-gadget - the gadget configuration core for the USB port</span></p>
<p class="p9"><span class="s3">letux-ip-over-usb-gadget - allows RNDIS etc.</span></p>
<p class="p9"><span class="s3">letux-tty-gadget - opens a serial port over USB</span></p>
<p class="p9"><span class="s3">letux-smb - allow SMB access to the device</span></p>
<p class="p13"><span class="s1"></span><br></p>
<p class="p14"><span class="s4">The Letux Repository at: <a href="https://download.goldelico.com/letux-debian-rootfs/debian"><span class="s5">https://download.goldelico.com/letux-debian-rootfs/debian</span></a></span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p12"><span class="s1"><b>2.4 Installation</b></span></p>
<p class="p5"><span class="s1">Take a fresh µSD card into a host computer card reader.</span></p>
<p class="p14"><span class="s4">Download makesd: <a href="https://projects.goldelico.com/p/gta04-makesd/"><span class="s5">https://projects.goldelico.com/p/gta04-makesd</span></a></span></p>
<p class="p13"><span class="s1"></span><br></p>
<p class="p5"><span class="s1">Run (may need to run as root user to have access to the SD reader:</span></p>
<p class="p13"><span class="s1"></span><br></p>
<p class="p9"><span class="s6">$ </span><span class="s3">SD=/dev/sd... ./makesd -vr retrode lx16e</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p12"><span class="s1"><b>2.5 WLAN</b></span></p>
<p class="p5"><span class="s1">WLAN (and BLE) is provided by an ESP32-WROOM6.</span></p>
<p class="p5"><span class="s1">The esp-hosetng driver is included in the LetuxOS kernels.</span></p>
<p class="p13"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><b>2.5.1 Installation of the ESP firmware</b></span></p>
<p class="p5"><span class="s1">There is a special tool letux-esp-serial-flasher that must be</span></p>
<p class="p5"><span class="s1">installed on the board through</span></p>
<p class="p13"><span class="s1"></span><br></p>
<p class="p9"><span class="s3">root@letux:~# apt-get update</span></p>
<p class="p9"><span class="s3">root@letux:~# apt-get install letux-esp-serial-flasher</span></p>
<p class="p13"><span class="s1"></span><br></p>
<p class="p5"><span class="s1">Then run</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p9"><span class="s3">root@letux:~# /usr/local/bin/mipsel-linux-gnu/esp-flasher</span></p>
<p class="p13"><span class="s1"></span><br></p>
<p class="p5"><span class="s1">It will directly control the ESP32 to bring the boot ROM into</span></p>
<p class="p5"><span class="s1">flashing mode. Then, it will send the binaries though an UART</span></p>
<p class="p5"><span class="s1">into the ESP32.</span></p>
<p class="p5"><span class="s1">This takes approx. 2 minutes.</span></p>
<p class="p5"><span class="s1">Afterwards WLAN should work:</span></p>
<p class="p9"><span class="s3">/root/wlan-scan</span></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p10"><span class="s1"></span><br></p>
<p class="p10"><span class="s1"></span><br></p>
</body>
</html>
