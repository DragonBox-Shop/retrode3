#!/bin/bash
# retrode-read slot - read game from slot
# return file name of result (empty if download failed)

LOG=/var/log/oscr/
MODE=oscr-read
GAMES=/usr/local/games/oscr

mkdir -p $LOG $GAMES

while [ "$1" ]
do
	case "$1" in
	md | /dev/slot-md )	# MD
		echo "200" | /usr/local/bin/oscr >$LOG/stdout.txt 2>$LOG/stderr.txt || exit 1
		;;
	snes | /dev/slot-snes )	# SNES
		echo "100 " | /usr/local/bin/oscr >$LOG/stdout.txt 2>$LOG/stderr.txt || exit 1
		;;
	nes | /dev/slot-nes )	# NES
		echo  "00 0 " | /usr/local/bin/oscr >$LOG/stdout.txt 2>$LOG/stderr.txt || exit 1
		;;
	-read | -write | -ram )
		MODE=oscr$1
		shift
		continue
		;;
	# add other modes here - can call other tools, e.g. based in libretrode and adapters
	-* )
		echo unknown option "$1"
		exit 1
		;;
	* )
		echo unknown device "$1"
		echo "  /dev/slot-md, /dev/slot-snes, /dev/slot-nes"
		exit 1
		;;
	esac
# FIXME: sobald oscr den echten Namen liefert, dann das mit .* und \.\.\. rausnehmen...
# grep "Saving to .*/.*/" $LOG/stdout.txt
	FILENAME=$(grep "Saving to .*/.*/" $LOG/stdout.txt | sed "s|Saving to \(.*\)/\.\.\.|$GAMES/\1|");
# echo "$FILENAME"
	[ "$FILENAME" ] && ls -1 "$FILENAME"/* 2>/dev/null
	shift
done