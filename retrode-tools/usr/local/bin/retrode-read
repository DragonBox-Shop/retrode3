#!/bin/bash
# retrode-read slot - read game from slot
# return file name of result (empty if download failed)

LOG=/var/log/oscr/
GAMES=/usr/local/games/retrode

case "$1" in
	/dev/slot-md )	# MD
		mkdir -p $LOG
		echo "200" | /usr/local/bin/oscr >$LOG/stdout.txt 2>$LOG/stderr.txt || exit 1
		;;
	/dev/slot-snes )	# SNES
		mkdir -p $LOG
		echo "100 " | /usr/local/bin/oscr >$LOG/stdout.txt 2>$LOG/stderr.txt || exit 1
		;;
	/dev/slot-nes )	# NES
		mkdir -p $LOG
		echo  "00 0 " | /usr/local/bin/oscr >$LOG/stdout.txt 2>$LOG/stderr.txt || exit 1
		;;
	* )
		echo unknown device "$1"
		echo "  /dev/slot-md, /dev/slot-snes, /dev/slot-nes"
		exit 1
		;;
esac

# FIXME: sobald oscr den echten Namen liefert, dann das mit .* und \.\.\. rausnehmen...
# grep "Saving to .*/ROM" $LOG/stdout.txt
FILENAME=$(grep "Saving to .*/ROM" $LOG/stdout.txt | sed "s|Saving to \(.*\)/\.\.\.|$GAMES/\1|");
# echo "$FILENAME"
[ "$FILENAME" ] && ls -1 "$FILENAME"/* 2>/dev/null
